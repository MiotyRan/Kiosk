<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>üçπ Brasserie Claouey - Commandez vos repas!</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
        <style>
            /* Import Google Fonts */
            @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap');

            /* Variables CSS pour th√®me color√© */
            :root {
                --primary: #1e40af;
                --secondary: #16a34a; 
                --tertiary: #eab308;    
                --accent: #f59e0b;      
                --success: #22c55e; 
                --bg-gradient: linear-gradient(135deg, #3b82f6 0%, #22c55e 50%, #eab308 100%);
                --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
                --bounce-timing: cubic-bezier(0.68, -0.55, 0.265, 1.55);
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                -webkit-tap-highlight-color: transparent;
            }

            body {
                font-family: 'Poppins', sans-serif;
                background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                overflow-x: hidden;
                user-select: none;
                -webkit-user-select: none;
                touch-action: manipulation;
            }

            /* Animations globales */
            @keyframes pulse-glow {
                0%, 100% { box-shadow: 0 0 20px rgba(30, 64, 175, 0.5); }
                50% { box-shadow: 0 0 40px rgba(30, 64, 175, 0.8); }
            }

            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }

            @keyframes confetti-fall {
                0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
                100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
            }

            @keyframes bounce-in {
                0% { transform: scale(0.8); opacity: 0; }
                100% { transform: scale(1); opacity: 1; }
            }

            @keyframes slideInUp {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* Classes d'animation */
            .pulse-glow {
                animation: pulse-glow 2s ease-in-out infinite;
            }

            .shake-animation {
                animation: shake 0.5s ease-in-out;
            }

            .bounce-in {
                animation: bounce-in 0.4s ease-out;
            }

            .slide-in-up {
                animation: slideInUp 0.3s ease-out;
            }

            /* Header moderne */
            .modern-header {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
                box-shadow: 0 5px 30px rgba(0, 0, 0, 0.1);
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 1000;
            }

            /* Boutons attractifs */
            .action-button {
                background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 50%, var(--tertiary) 100%);
                color: white;
                border: none;
                border-radius: 50px;
                padding: 15px 30px;
                font-weight: 600;
                font-size: 18px;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
            }

            .action-button:before {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 0;
                height: 0;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.3);
                transform: translate(-50%, -50%);
                transition: width 0.6s, height 0.6s;
            }

            .action-button:hover {
                transform: translateY(-3px);
                box-shadow: 0 10px 30px rgba(30, 64, 175, 0.3);
            }

            .action-button:active:before {
                width: 300px;
                height: 300px;
            }

            /* Service mode cards */
            .service-card {
                background: white;
                border-radius: 30px;
                padding: 3rem;
                cursor: pointer;
                transition: all 0.4s ease;
                position: relative;
                overflow: hidden;
                border: 2px solid transparent;
            }

            .service-card:before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
                transition: left 0.5s;
            }

            .service-card:hover:before {
                left: 100%;
            }

            .service-card:hover {
                transform: translateY(-10px) scale(1.02);
                box-shadow: 0 25px 50px rgba(30, 64, 175, 0.15);
                border-color: var(--primary);
            }

            .service-card:active {
                transform: translateY(-5px) scale(0.98);
            }

            /* Table selection */
            .table-button {
                background: white;
                border: 3px solid #e5e7eb;
                border-radius: 20px;
                padding: 2rem;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
            }

            .table-button:hover {
                border-color: var(--primary);
                background: linear-gradient(135deg, #fff 0%, #eff6ff 100%);
                transform: translateY(-5px);
            }

            .table-button.occupied {
                border-color: #ef4444;
                background: #fee2e2;
                cursor: not-allowed;
            }

            .table-button.selected {
                border-color: var(--primary);
                background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
                color: white;
            }

            /* Allergen selection */
            .allergen-card {
                background: white;
                border: 2px solid #e5e7eb;
                border-radius: 15px;
                padding: 1rem;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .allergen-card:hover {
                border-color: var(--tertiary);
                background: #fef3c7;
            }

            .allergen-card.selected {
                border-color: var(--tertiary);
                background: linear-gradient(135deg, #fbbf24 0%, var(--tertiary) 100%);
                color: #92400e;
                transform: scale(1.05);
            }

            /* Product cards */
            .product-card {
                background: white;
                border-radius: 20px;
                overflow: hidden;
                transform-style: preserve-3d;
                transition: all 0.3s ease;
                cursor: pointer;
                position: relative;
            }

            .product-card:hover {
                transform: translateY(-10px) scale(1.02);
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            }

            .product-card:active {
                transform: translateY(-5px) scale(0.98);
            }

            .product-card.selected {
                border: 3px solid var(--primary);
                box-shadow: 0 0 30px rgba(30, 64, 175, 0.4);
            }

            /* Floating cart */
            .floating-cart {
                position: fixed;
                bottom: 30px;
                right: 30px;
                background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 50%, var(--tertiary) 100%);
                color: white;
                width: 80px;
                height: 80px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                box-shadow: 0 10px 30px rgba(30, 64, 175, 0.4);
                transition: all 0.3s ease;
                z-index: 999;
            }

            .floating-cart:hover {
                transform: scale(1.1) rotate(10deg);
                box-shadow: 0 15px 40px rgba(30, 64, 175, 0.6);
            }

            .floating-cart.has-items {
                animation: pulse-glow 2s ease-in-out infinite;
            }

            /* Badge de quantit√© */
            .quantity-badge {
                background: var(--accent);
                color: white;
                border-radius: 20px;
                padding: 5px 15px;
                font-weight: 700;
                font-size: 14px;
                position: absolute;
                top: -10px;
                right: -10px;
                animation: bounce-in 0.5s ease;
            }

            /* Modal moderne */
            .modern-modal {
                background: rgba(0, 0, 0, 0.8);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                position: fixed;
                inset: 0;
                z-index: 2000;
                display: none;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }

            .modern-modal.active {
                display: flex;
            }

            .modal-content {
                background: white;
                border-radius: 30px;
                padding: 40px;
                max-width: 600px;
                width: 100%;
                position: relative;
                animation: bounce-in 0.5s var(--bounce-timing);
                max-height: 90vh;
                overflow-y: auto;
            }

            /* Toast notifications */
            .fun-toast {
                position: fixed;
                top: 100px;
                left: 50%;
                transform: translateX(-50%) translateY(-100px);
                background: white;
                padding: 20px 40px;
                border-radius: 50px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
                font-weight: 600;
                opacity: 0;
                transition: all 0.5s var(--bounce-timing);
                z-index: 3000;
            }

            .fun-toast.show {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }

            .fun-toast.success {
                background: linear-gradient(135deg, var(--success) 0%, #10b981 100%);
                color: white;
            }

            .fun-toast.info {
                background: linear-gradient(135deg, var(--primary) 0%, #3b82f6 100%);
                color: white;
            }

            .fun-toast.error {
                background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                color: white;
            }

            /* Touch feedback */
            .touch-feedback:active {
                transform: scale(0.98);
            }

            /* Progress bar */
            .progress-bar {
                background: #f0f0f0;
                height: 8px;
                border-radius: 10px;
                overflow: hidden;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 50%, var(--tertiary) 100%);
                border-radius: 10px;
                transition: width 0.5s ease;
                position: relative;
                overflow: hidden;
            }

            .progress-fill:after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.3) 50%, transparent 100%);
                animation: shimmer 2s infinite;
            }

            @keyframes shimmer {
                0% { transform: translateX(-100%); }
                100% { transform: translateX(100%); }
            }

            /* Categories */
            .category-pill {
                background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
                color: white;
                padding: 12px 30px;
                border-radius: 30px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
            }

            .category-pill:hover {
                transform: translateY(-3px) scale(1.05);
                box-shadow: 0 5px 20px rgba(30, 64, 175, 0.4);
            }

            .category-pill.active {
                background: linear-gradient(135deg, var(--secondary) 0%, var(--tertiary) 100%);
                transform: scale(1.1);
            }

            /* Responsive */
            @media (max-width: 768px) {
                .service-card {
                    padding: 2rem;
                }
                
                .floating-cart {
                    bottom: 20px;
                    right: 20px;
                    width: 70px;
                    height: 70px;
                }
            }
        </style>
    </head>
    <body>
        <!-- Header -->
        <header class="modern-header py-4 px-6">
            <div class="max-w-7xl mx-auto flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="text-4xl animated-emoji">üçΩÔ∏è</div>
                    <div>
                        <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-600 via-green-600 to-yellow-500 bg-clip-text text-transparent">
                            Brasserie Claouey
                        </h1>
                        <p class="text-gray-600">Commande en libre-service</p>
                    </div>
                </div>
                
                <div class="flex items-center gap-6">
                    <!-- Indicateur de connexion -->
                    <div id="connection-indicator" class="bg-green-500 text-white px-4 py-2 rounded-full text-sm">
                        <i class="fas fa-wifi mr-2"></i>En ligne
                    </div>
                </div>
            </div>
        </header>

        <!-- Contenu principal -->
        <main class="pt-28 pb-32 px-4 max-w-7xl mx-auto">
            <!-- √âtape 1: S√©lection du mode de service -->
            <div id="service-mode-screen" class="slide-in-up">
                <div class="text-center mb-12 bounce-in">
                    <h2 class="text-4xl md:text-6xl font-bold mb-4">
                        <span class="bg-gradient-to-r from-blue-700 via-green-700 to-yellow-500 bg-clip-text text-transparent">
                            Que d√©sirez-vous aujourd'hui ?
                        </span>
                    </h2>
                    <p class="text-gray-600 text-xl md:text-2xl">Commandez en quelques clics et profitez ! üéâ</p>
                    <p class="text-gray-500 text-lg mt-2">Choisissez votre mode de service</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl mx-auto">
                    <div class="service-card touch-feedback" onclick="setServiceMode('sur_place')">
                        <div class="text-center">
                            <div class="bg-blue-100 w-32 h-32 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-utensils text-6xl text-blue-600"></i>
                            </div>
                            <h3 class="text-3xl font-bold text-gray-800 mb-4">Sur Place</h3>
                            <p class="text-gray-600 text-lg">Consommez dans notre √©tablissement</p>
                        </div>
                    </div>
                    
                    <div class="service-card touch-feedback" onclick="setServiceMode('a_emporter')">
                        <div class="text-center">
                            <div class="bg-green-100 w-32 h-32 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-shopping-bag text-6xl text-green-600"></i>
                            </div>
                            <h3 class="text-3xl font-bold text-gray-800 mb-4">√Ä Emporter</h3>
                            <p class="text-gray-600 text-lg">R√©cup√©rez votre commande</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- √âtape 2: S√©lection de table -->
            <div id="table-selection-screen" class="hidden slide-in-up">
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold text-gray-800 mb-4">Choisissez votre table</h2>
                    <p class="text-lg text-gray-600">S√©lectionnez le num√©ro de votre table</p>
                </div>
                
                <!-- L√©gende -->
                <div class="flex justify-center gap-8 mb-8">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-white border-2 border-gray-300 rounded"></div>
                        <span class="text-sm">Disponible</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-red-200 border-2 border-red-400 rounded"></div>
                        <span class="text-sm">Occup√©e</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-gradient-to-r from-blue-500 via-green-500 to-yellow-500 rounded"></div>
                        <span class="text-sm">S√©lectionn√©e</span>
                    </div>
                </div>
                
                <div id="table-grid" class="grid grid-cols-5 gap-4 max-w-4xl mx-auto mb-8">
                    <!-- Tables g√©n√©r√©es dynamiquement -->
                </div>
                
                <div class="text-center">
                    <button onclick="goBackToServiceMode()" 
                            class="bg-gray-300 text-gray-700 px-8 py-4 rounded-xl text-lg font-semibold hover:bg-gray-400 touch-feedback">
                        <i class="fas fa-arrow-left mr-2"></i>Retour
                    </button>
                </div>
            </div>

            <!-- √âtape 3: S√©lection des allerg√®nes -->
            <div id="allergen-selection-screen" class="hidden slide-in-up">
                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold text-gray-800 mb-4">Allergies et intol√©rances</h2>
                    <p class="text-lg text-gray-600 mb-6">S√©lectionnez vos allergies pour filtrer automatiquement le menu</p>
                    <div class="bg-yellow-100 border-l-4 border-yellow-400 p-4 max-w-2xl mx-auto rounded">
                        <p class="text-yellow-800">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            Cette information nous aide √† vous proposer des produits adapt√©s
                        </p>
                    </div>
                </div>
                
                <div id="allergen-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 max-w-6xl mx-auto mb-8">
                    <!-- Allerg√®nes g√©n√©r√©s dynamiquement -->
                </div>
                
                <div class="text-center space-x-4">
                    <button onclick="skipAllergenSelection()" 
                            class="bg-gray-300 text-gray-700 px-8 py-4 rounded-xl text-lg font-semibold hover:bg-gray-400 touch-feedback">
                        Aucune allergie
                    </button>
                    <button onclick="confirmAllergenSelection()" 
                            class="action-button text-white px-8 py-4 text-lg font-semibold touch-feedback">
                        Confirmer et voir le menu
                    </button>
                    <button onclick="goBackToServiceMode()" 
                            class="bg-gray-300 text-gray-700 px-8 py-4 rounded-xl text-lg font-semibold hover:bg-gray-400 touch-feedback">
                        <i class="fas fa-arrow-left mr-2"></i>Retour
                    </button>
                </div>
            </div>

            <!-- √âtape 4: Menu principal -->
            <div id="main-menu-screen" class="hidden">
                <!-- Hero Section -->
                <div class="text-center mb-8 bounce-in">
                    <h2 class="text-4xl md:text-5xl font-bold mb-4">
                        <span class="bg-gradient-to-r from-blue-700 via-green-700 to-yellow-500 bg-clip-text text-transparent">
                            Notre Menu
                        </span>
                    </h2>
                    <p class="text-gray-600 text-lg">S√©lectionnez vos plats favoris ! üçΩÔ∏è</p>
                </div>

                <!-- Barre de recherche -->
                <div class="relative max-w-2xl mx-auto mb-8">
                    <input type="text" 
                        id="searchInput"
                        placeholder="üîç Rechercher un plat..." 
                        class="w-full px-6 py-4 pl-14 rounded-full border-2 border-gray-200 focus:border-blue-500 focus:outline-none text-lg transition-all duration-300 focus:shadow-lg">
                    <i class="fas fa-search absolute left-5 top-1/2 transform -translate-y-1/2 text-gray-400 text-xl"></i>
                </div>

                <!-- Cat√©gories -->
                <div class="flex flex-wrap gap-4 justify-center mb-8" id="categories-nav">
                    <!-- Cat√©gories g√©n√©r√©es dynamiquement -->
                </div>

                <!-- Progress Bar -->
                <div class="max-w-4xl mx-auto mb-8">
                    <div class="flex justify-between text-sm font-medium text-gray-600 mb-2">
                        <span>S√©lectionnez vos plats</span>
                        <span>3 articles minimum pour -10% ! üéÅ</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Grille des produits -->
                <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <!-- Produits g√©n√©r√©s dynamiquement -->
                </div>
            </div>
        </main>

        <!-- Panier flottant -->
        <div class="floating-cart" id="floatingCart" onclick="openCart()">
            <i class="fas fa-shopping-cart text-3xl"></i>
            <span class="quantity-badge" id="cartCount" style="display: none;">0</span>
        </div>

        <!-- Modal Panier -->
        <div class="modern-modal" id="cartModal">
            <div class="modal-content">
                <button onclick="closeCart()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-2xl"></i>
                </button>
                
                <h3 class="text-2xl font-bold mb-6 text-center">
                    <span class="bg-gradient-to-r from-blue-600 via-green-600 to-yellow-500 bg-clip-text text-transparent">
                        Votre commande üõí
                    </span>
                </h3>
                
                <div id="cartItems" class="space-y-4 mb-6">
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-shopping-cart text-6xl mb-4 opacity-50"></i>
                        <p class="text-xl">Votre panier est vide</p>
                    </div>
                </div>
                
                <div id="cart-footer" class="hidden border-t pt-4">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-lg font-semibold">Total</span>
                        <span class="text-2xl font-bold text-green-600" id="cartTotal">0,00‚Ç¨</span>
                    </div>
                    
                    <button onclick="proceedToCheckout()" class="action-button w-full">
                        Proc√©der au paiement üéâ
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal Produit -->
        <div class="modern-modal" id="productModal">
            <!-- Contenu g√©n√©r√© dynamiquement -->
        </div>

        <!-- Modal Paiement -->
        <div class="modern-modal" id="paymentModal">
            <div class="modal-content">
                <h3 class="text-2xl font-bold text-center mb-6">Choisir le mode de paiement</h3>
                
                <div class="grid grid-cols-2 gap-6">
                    <button onclick="processCashPayment()" 
                            class="bg-green-500 text-white p-8 rounded-xl text-xl font-semibold hover:bg-green-600 touch-feedback">
                        <i class="fas fa-money-bill-wave text-6xl mb-4"></i>
                        <br>Esp√®ces
                    </button>
                    <button onclick="processCardPayment()" 
                            class="bg-blue-500 text-white p-8 rounded-xl text-xl font-semibold hover:bg-blue-600 touch-feedback">
                        <i class="fas fa-credit-card text-6xl mb-4"></i>
                        <br>Carte Bancaire
                    </button>
                </div>
            </div>
        </div>

        <!-- √âcran de confirmation -->
        <div id="confirmation-screen" class="hidden fixed inset-0 bg-white z-50 flex items-center justify-center">
            <div class="text-center p-8 bounce-in">
                <div class="w-32 h-32 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-8">
                    <i class="fas fa-check text-6xl text-green-600"></i>
                </div>
                <h2 class="text-4xl font-bold text-gray-800 mb-4">Commande confirm√©e !</h2>
                <p class="text-xl text-gray-600 mb-2">Num√©ro de commande :</p>
                <p id="order-number" class="text-3xl font-bold text-blue-600 mb-8">#BC-000001</p>
                
                <div class="space-y-4">
                    <p class="text-lg text-gray-700">Votre commande est en cours de pr√©paration</p>
                    <p class="text-gray-600">Temps d'attente estim√© : <span id="estimated-time" class="font-semibold">15-20 minutes</span></p>
                </div>
                
                <button onclick="startNewOrder()" 
                        class="mt-8 action-button text-white px-8 py-4 text-lg font-semibold touch-feedback">
                    Nouvelle commande
                </button>
            </div>
        </div>

        <!-- Toast notifications -->
        <div class="fun-toast" id="toast"></div>

        <!-- JavaScript -->
        <script>
            // Configuration des allerg√®nes (14 obligatoires UE)
            const ALLERGENS = {
                1: { code: 'GLU', name: 'Gluten', icon: 'üåæ' },
                2: { code: 'CRU', name: 'Crustac√©s', icon: 'ü¶ê' },
                3: { code: 'EGG', name: '≈íufs', icon: 'ü•ö' },
                4: { code: 'FSH', name: 'Poisson', icon: 'üêü' },
                5: { code: 'PNT', name: 'Arachides', icon: 'ü•ú' },
                6: { code: 'SOY', name: 'Soja', icon: 'üå±' },
                7: { code: 'MLK', name: 'Lait', icon: 'ü•õ' },
                8: { code: 'NUT', name: 'Fruits √† coque', icon: 'üå∞' },
                9: { code: 'CEL', name: 'C√©leri', icon: 'ü•¨' },
                10: { code: 'MUS', name: 'Moutarde', icon: 'üü°' },
                11: { code: 'SES', name: 'Graines de s√©same', icon: '‚ö™' },
                12: { code: 'SUL', name: 'Sulfites', icon: 'üß™' },
                13: { code: 'LUP', name: 'Lupin', icon: 'üåø' },
                14: { code: 'MOL', name: 'Mollusques', icon: 'ü¶™' }
            };

            // Configuration des tables (20 tables)
            const TABLE_NUMBERS = Array.from({length: 20}, (_, i) => i + 1);
            const TABLE_STATUS = {}; // Simuler statut des tables

            // √âtat de l'application
            const appState = {
                currentScreen: 'service-mode',
                serviceMode: null,
                tableNumber: null,
                customerAllergens: [],
                cart: [],
                currentCategory: 'all',
                products: [],
                categories: []
            };

            // Base de donn√©es produits simul√©e
            const mockProducts = [
                {
                    id: 1,
                    name: 'Burger Classic',
                    description: 'Pain de b≈ìuf, salade, tomates, cornichons',
                    price: 12.50,
                    category: 'burgers',
                    image_url: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=300&h=200&fit=crop',
                    allergens: [1, 3, 7],
                    emoji: 'üçî'
                },
                {
                    id: 2,
                    name: 'Salade C√©sar',
                    description: 'Salade, poulet grill√©, parmesan, cro√ªtons',
                    price: 9.90,
                    category: 'salades',
                    image_url: 'https://images.unsplash.com/photo-1540420773420-3366772f4999?w=300&h=200&fit=crop',
                    allergens: [1, 3, 4, 7],
                    emoji: 'ü•ó'
                },
                {
                    id: 3,
                    name: 'Pizza Margherita',
                    description: 'Sauce tomate, mozzarella, basilic frais',
                    price: 14.00,
                    category: 'pizzas',
                    image_url: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=300&h=200&fit=crop',
                    allergens: [1, 7],
                    emoji: 'üçï'
                },
                {
                    id: 4,
                    name: 'Coca-Cola',
                    description: 'Boisson gazeuse rafra√Æchissante',
                    price: 2.50,
                    category: 'boissons',
                    image_url: 'https://images.unsplash.com/photo-1581636625402-29d2d0b5c9c0?w=300&h=200&fit=crop',
                    allergens: [],
                    emoji: 'ü•§'
                },
                {
                    id: 5,
                    name: 'Bi√®re Pression',
                    description: 'Bi√®re blonde fra√Æche du moment',
                    price: 4.50,
                    category: 'boissons',
                    image_url: 'https://images.unsplash.com/photo-1558642452-9d2a7deb7f62?w=300&h=200&fit=crop',
                    allergens: [1],
                    emoji: 'üç∫'
                }
            ];

            const mockCategories = [
                { id: 'all', name: 'Tout voir', icon: '‚ú®', active: true },
                { id: 'burgers', name: 'Burgers', icon: 'üçî', active: true },
                { id: 'salades', name: 'Salades', icon: 'ü•ó', active: true },
                { id: 'pizzas', name: 'Pizzas', icon: 'üçï', active: true },
                { id: 'boissons', name: 'Boissons', icon: 'ü•§', active: true }
            ];

            // Initialisation
            document.addEventListener('DOMContentLoaded', function() {
                console.log('üöÄ Kiosque initialis√©');
                appState.products = mockProducts;
                appState.categories = mockCategories;
                
                generateAllergenGrid();
                generateTableGrid();
                initializeEventListeners();
            });

            function initializeEventListeners() {
                // Recherche
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    searchInput.addEventListener('input', debounce(handleSearch, 300));
                }
            }

            // GESTION DES √âCRANS
            
            function showScreen(screenId) {
                document.querySelectorAll('[id$="-screen"]').forEach(screen => {
                    screen.classList.add('hidden');
                });
                
                const screen = document.getElementById(screenId);
                if (screen) {
                    screen.classList.remove('hidden');
                    screen.classList.add('slide-in-up');
                    appState.currentScreen = screenId.replace('-screen', '');
                }
            }

            // S√âLECTION DU MODE DE SERVICE
            
            function setServiceMode(mode) {
                appState.serviceMode = mode;
                
                if (mode === 'sur_place') {
                    showScreen('table-selection-screen');
                } else {
                    showScreen('allergen-selection-screen');
                }
                
                showToast(`Mode "${mode === 'sur_place' ? 'Sur place' : '√Ä emporter'}" s√©lectionn√©`, 'success');
            }

            function goBackToServiceMode() {
                appState.serviceMode = null;
                appState.tableNumber = null;
                showScreen('service-mode-screen');
            }

            // GESTION DES TABLES
            
            function generateTableGrid() {
                const grid = document.getElementById('table-grid');
                if (!grid) return;
                
                // Simuler quelques tables occup√©es
                TABLE_STATUS[3] = 'occupied';
                TABLE_STATUS[7] = 'occupied';
                TABLE_STATUS[12] = 'occupied';
                
                grid.innerHTML = TABLE_NUMBERS.map(num => {
                    const isOccupied = TABLE_STATUS[num] === 'occupied';
                    const isSelected = appState.tableNumber === num;
                    
                    return `
                        <div class="table-button ${isOccupied ? 'occupied' : ''} ${isSelected ? 'selected' : ''} touch-feedback"
                            onclick="${isOccupied ? '' : `setTableNumber(${num})`}">
                            <div class="text-center">
                                <div class="text-2xl mb-2">${isOccupied ? '‚ùå' : isSelected ? '‚úÖ' : 'ü™ë'}</div>
                                <div class="text-xl font-bold">Table ${num}</div>
                                <div class="text-sm text-gray-500">
                                    ${isOccupied ? 'Occup√©e' : 'Disponible'}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            function setTableNumber(tableNum) {
                if (TABLE_STATUS[tableNum] === 'occupied') {
                    showToast('Cette table est occup√©e', 'error');
                    return;
                }
                
                appState.tableNumber = tableNum;
                generateTableGrid(); // Refresh pour afficher la s√©lection
                
                setTimeout(() => {
                    showScreen('allergen-selection-screen');
                    showToast(`Table ${tableNum} s√©lectionn√©e`, 'success');
                }, 500);
            }

            // GESTION DES ALLERG√àNES
            
            function generateAllergenGrid() {
                const grid = document.getElementById('allergen-grid');
                if (!grid) return;
                
                grid.innerHTML = Object.entries(ALLERGENS).map(([id, allergen]) => `
                    <label class="allergen-card touch-feedback" onclick="toggleAllergen(${id})">
                        <input type="checkbox" 
                            class="allergen-checkbox hidden" 
                            value="${id}"
                            id="allergen-${id}">
                        <div class="text-center">
                            <div class="text-4xl mb-2">${allergen.icon}</div>
                            <div class="font-semibold">${allergen.name}</div>
                            <div class="text-xs text-gray-500">${allergen.code}</div>
                        </div>
                    </label>
                `).join('');
            }

            function toggleAllergen(allergenId) {
                const checkbox = document.getElementById(`allergen-${allergenId}`);
                const card = checkbox.closest('.allergen-card');
                
                if (appState.customerAllergens.includes(allergenId)) {
                    // Retirer l'allerg√®ne
                    appState.customerAllergens = appState.customerAllergens.filter(id => id !== allergenId);
                    card.classList.remove('selected');
                    checkbox.checked = false;
                } else {
                    // Ajouter l'allerg√®ne
                    appState.customerAllergens.push(allergenId);
                    card.classList.add('selected');
                    checkbox.checked = true;
                    card.querySelector('.text-4xl').textContent = '‚úÖ';
                }
            }

            function skipAllergenSelection() {
                appState.customerAllergens = [];
                proceedToMenu();
            }

            function confirmAllergenSelection() {
                if (appState.customerAllergens.length > 0) {
                    showToast(`Filtre appliqu√© pour ${appState.customerAllergens.length} allerg√®ne(s)`, 'success');
                }
                proceedToMenu();
            }

            function proceedToMenu() {
                showScreen('main-menu-screen');
                renderCategories();
                renderProducts();
            }

            // GESTION DU MENU
            
            function renderCategories() {
                const nav = document.getElementById('categories-nav');
                if (!nav) return;
                
                nav.innerHTML = appState.categories.map(category => `
                    <button onclick="selectCategory('${category.id}')" 
                            class="category-pill ${appState.currentCategory === category.id ? 'active' : ''} touch-feedback">
                        <span class="mr-2">${category.icon}</span>
                        ${category.name}
                    </button>
                `).join('');
            }

            function selectCategory(categoryId) {
                appState.currentCategory = categoryId;
                renderCategories();
                renderProducts();
            }

            function renderProducts() {
                const grid = document.getElementById('products-grid');
                if (!grid) return;
                
                let filteredProducts = appState.products;
                
                // Filtrer par cat√©gorie
                if (appState.currentCategory !== 'all') {
                    filteredProducts = filteredProducts.filter(product => 
                        product.category === appState.currentCategory
                    );
                }
                
                // Filtrer par allerg√®nes
                if (appState.customerAllergens.length > 0) {
                    filteredProducts = filteredProducts.filter(product => 
                        !product.allergens.some(allergenId => 
                            appState.customerAllergens.includes(allergenId)
                        )
                    );
                }
                
                if (filteredProducts.length === 0) {
                    grid.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <i class="fas fa-exclamation-triangle text-6xl text-gray-400 mb-4"></i>
                            <p class="text-xl text-gray-500">Aucun produit disponible</p>
                            ${appState.customerAllergens.length > 0 ? 
                            '<p class="text-gray-400">Essayez de modifier vos restrictions alimentaires</p>' : ''}
                        </div>
                    `;
                    return;
                }
                
                grid.innerHTML = filteredProducts.map(product => `
                    <div class="product-card touch-feedback" onclick="showProductModal(${product.id})">
                        <div class="relative overflow-hidden">
                            <img src="${product.image_url}" alt="${product.name}" class="w-full h-48 object-cover">
                            ${renderAllergenBadges(product.allergens)}
                        </div>
                        <div class="p-4">
                            <h3 class="text-xl font-bold mb-2">${product.name}</h3>
                            <p class="text-gray-600 mb-4">${product.description}</p>
                            <div class="flex items-center justify-between">
                                <span class="text-2xl font-bold text-green-600">${product.price.toFixed(2)}‚Ç¨</span>
                                <button class="bg-gradient-to-r from-blue-600 via-green-600 to-yellow-500 text-white p-3 rounded-full hover:shadow-lg transition-all duration-300 touch-feedback">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            function renderAllergenBadges(allergens) {
                if (!allergens || allergens.length === 0) return '';
                
                return `
                    <div class="absolute top-2 left-2">
                        <div class="flex flex-wrap gap-1">
                            ${allergens.map(allergenId => {
                                const allergen = ALLERGENS[allergenId];
                                return allergen ? `
                                    <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded" 
                                        title="${allergen.name}">
                                        ${allergen.icon}
                                    </span>
                                ` : '';
                            }).join('')}
                        </div>
                    </div>
                `;
            }

            function showProductModal(productId) {
                const product = appState.products.find(p => p.id === productId);
                if (!product) return;
                
                const modal = document.getElementById('productModal');
                modal.innerHTML = `
                    <div class="modal-content">
                        <button onclick="closeProductModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                        
                        <div class="text-center mb-6">
                            <div class="text-6xl mb-4">${product.emoji}</div>
                            <h2 class="text-3xl font-bold mb-2">${product.name}</h2>
                            <p class="text-gray-600 mb-4">${product.description}</p>
                            <div class="text-3xl font-bold text-green-600 mb-6">${product.price.toFixed(2)}‚Ç¨</div>
                        </div>
                        
                        ${product.allergens.length > 0 ? `
                            <div class="bg-yellow-50 border border-yellow-200 p-4 rounded-lg mb-6">
                                <p class="font-semibold text-yellow-800 mb-2">Allerg√®nes pr√©sents :</p>
                                <div class="flex flex-wrap gap-2">
                                    ${product.allergens.map(id => `
                                        <span class="bg-yellow-200 text-yellow-800 px-2 py-1 rounded text-sm">
                                            ${ALLERGENS[id].icon} ${ALLERGENS[id].name}
                                        </span>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold mb-3">Quantit√©</h3>
                            <div class="flex items-center justify-center space-x-4">
                                <button onclick="decreaseQuantity()" class="bg-gray-200 hover:bg-gray-300 w-12 h-12 rounded-full flex items-center justify-center">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span id="quantity" class="text-2xl font-bold">1</span>
                                <button onclick="increaseQuantity()" class="bg-gray-200 hover:bg-gray-300 w-12 h-12 rounded-full flex items-center justify-center">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold mb-3">Instructions sp√©ciales</h3>
                            <textarea id="special-instructions" 
                                    class="w-full p-3 border border-gray-300 rounded-lg resize-none" 
                                    rows="3" 
                                    placeholder="Ex: Sans oignons, bien cuit, etc..."></textarea>
                        </div>
                        
                        <div class="flex space-x-4">
                            <button onclick="closeProductModal()" 
                                    class="flex-1 bg-gray-300 text-gray-700 py-4 rounded-xl text-lg font-semibold hover:bg-gray-400 touch-feedback">
                                Annuler
                            </button>
                            <button onclick="addToCart(${product.id})" 
                                    class="flex-1 action-button text-white py-4 text-lg font-semibold touch-feedback">
                                Ajouter au panier
                            </button>
                        </div>
                    </div>
                `;
                modal.classList.add('active');
            }

            function closeProductModal() {
                document.getElementById('productModal').classList.remove('active');
            }

            // GESTION DU PANIER
            
            function addToCart(productId) {
                const product = appState.products.find(p => p.id === productId);
                if (!product) return;

                const quantity = parseInt(document.getElementById('quantity').textContent) || 1;
                const specialInstructions = document.getElementById('special-instructions').value;

                const cartItem = {
                    id: Date.now(),
                    product_id: product.id,
                    product_name: product.name,
                    product_emoji: product.emoji,
                    quantity: quantity,
                    unit_price: product.price,
                    total_price: product.price * quantity,
                    special_instructions: specialInstructions,
                    image_url: product.image_url
                };

                appState.cart.push(cartItem);
                updateCartUI();
                closeProductModal();
                showToast(`${product.emoji} ${product.name} ajout√© au panier`, 'success');
                
                // Animation confetti si c'est le premier ajout
                if (appState.cart.length === 1) {
                    createConfetti();
                }
            }

            function updateCartUI() {
                const count = appState.cart.reduce((sum, item) => sum + item.quantity, 0);
                const cartCount = document.getElementById('cartCount');
                const cart = document.getElementById('floatingCart');
                
                if (count > 0) {
                    cartCount.textContent = count;
                    cartCount.style.display = 'block';
                    cart.classList.add('has-items');
                } else {
                    cartCount.style.display = 'none';
                    cart.classList.remove('has-items');
                }
                
                updateProgressBar();
            }

            function updateProgressBar() {
                const count = appState.cart.reduce((sum, item) => sum + item.quantity, 0);
                const progress = Math.min((count / 3) * 100, 100);
                const progressBar = document.getElementById('progressBar');
                if (progressBar) {
                    progressBar.style.width = progress + '%';
                }
                
                if (count >= 3 && !appState.promoApplied) {
                    showToast('üéâ F√©licitations ! -10% appliqu√© !', 'success');
                    createConfetti();
                    appState.promoApplied = true;
                }
            }

            function openCart() {
                const modal = document.getElementById('cartModal');
                renderCartItems();
                modal.classList.add('active');
            }

            function closeCart() {
                document.getElementById('cartModal').classList.remove('active');
            }

            function renderCartItems() {
                const container = document.getElementById('cartItems');
                const footer = document.getElementById('cart-footer');
                
                if (appState.cart.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-shopping-cart text-6xl mb-4 opacity-50"></i>
                            <p class="text-xl">Votre panier est vide</p>
                        </div>
                    `;
                    footer.classList.add('hidden');
                    return;
                }

                let total = appState.cart.reduce((sum, item) => sum + item.total_price, 0);
                const discount = appState.cart.length >= 3 ? 0.1 : 0;
                const finalTotal = total * (1 - discount);
                
                container.innerHTML = appState.cart.map(item => `
                    <div class="flex items-center space-x-4 p-4 border border-gray-200 rounded-lg">
                        <div class="text-3xl">${item.product_emoji}</div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800">${item.product_name}</h4>
                            <p class="text-sm text-gray-600">Quantit√©: ${item.quantity}</p>
                            ${item.special_instructions ? `
                                <p class="text-xs text-blue-600">Note: ${item.special_instructions}</p>
                            ` : ''}
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-green-600">${item.total_price.toFixed(2)}‚Ç¨</p>
                            <button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700 text-sm">
                                <i class="fas fa-trash"></i> Supprimer
                            </button>
                        </div>
                    </div>
                `).join('');
                
                if (discount > 0) {
                    container.innerHTML += `
                        <div class="text-center text-green-600 font-semibold p-4">
                            üéâ R√©duction de 10% appliqu√©e !
                        </div>
                    `;
                }

                document.getElementById('cartTotal').textContent = `${finalTotal.toFixed(2)}‚Ç¨`;
                footer.classList.remove('hidden');
            }

            function removeFromCart(itemId) {
                appState.cart = appState.cart.filter(item => item.id !== itemId);
                updateCartUI();
                renderCartItems();
                showToast('Article supprim√© du panier', 'info');
            }

            // PROCESSUS DE PAIEMENT
            
            function proceedToCheckout() {
                if (appState.cart.length === 0) {
                    showToast('Votre panier est vide', 'error');
                    return;
                }

                closeCart();
                document.getElementById('paymentModal').classList.add('active');
            }

            function processCashPayment() {
                processPayment('cash');
            }

            function processCardPayment() {
                processPayment('card');
            }

            async function processPayment(method) {
                document.getElementById('paymentModal').classList.remove('active');
                
                showToast('Traitement du paiement en cours...', 'info');
                
                // Simuler le traitement
                setTimeout(() => {
                    showConfirmationScreen();
                }, 2000);
            }

            function showConfirmationScreen() {
                const orderNumber = `BC-${Date.now().toString().slice(-6)}`;
                document.getElementById('order-number').textContent = `#${orderNumber}`;
                document.getElementById('confirmation-screen').classList.remove('hidden');
                
                createConfetti();
                showToast('üéâ Commande confirm√©e avec succ√®s !', 'success');
            }

            function startNewOrder() {
                // R√©initialiser l'√©tat
                appState.cart = [];
                appState.serviceMode = null;
                appState.tableNumber = null;
                appState.customerAllergens = [];
                appState.promoApplied = false;
                
                // Masquer l'√©cran de confirmation
                document.getElementById('confirmation-screen').classList.add('hidden');
                
                // R√©initialiser les checkboxes allerg√®nes
                document.querySelectorAll('.allergen-card').forEach(card => {
                    card.classList.remove('selected');
                });
                
                // Retourner √† l'√©cran de s√©lection du service
                showScreen('service-mode-screen');
                updateCartUI();
            }

            // UTILITAIRES
            
            function increaseQuantity() {
                const quantityEl = document.getElementById('quantity');
                const current = parseInt(quantityEl.textContent);
                if (current < 20) {
                    quantityEl.textContent = current + 1;
                }
            }

            function decreaseQuantity() {
                const quantityEl = document.getElementById('quantity');
                const current = parseInt(quantityEl.textContent);
                if (current > 1) {
                    quantityEl.textContent = current - 1;
                }
            }

            function handleSearch(e) {
                const query = e.target.value.toLowerCase();
                
                if (query === '') {
                    renderProducts();
                    return;
                }
                
                const filteredProducts = appState.products.filter(product => 
                    product.name.toLowerCase().includes(query) ||
                    product.description.toLowerCase().includes(query)
                );
                
                const grid = document.getElementById('products-grid');
                if (filteredProducts.length === 0) {
                    grid.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <i class="fas fa-search text-6xl text-gray-400 mb-4"></i>
                            <p class="text-xl text-gray-500">Aucun r√©sultat pour "${query}"</p>
                        </div>
                    `;
                    return;
                }
                
                // Utiliser la m√™me logique de rendu que renderProducts
                grid.innerHTML = filteredProducts.map(product => `
                    <div class="product-card touch-feedback" onclick="showProductModal(${product.id})">
                        <div class="relative overflow-hidden">
                            <img src="${product.image_url}" alt="${product.name}" class="w-full h-48 object-cover">
                            ${renderAllergenBadges(product.allergens)}
                        </div>
                        <div class="p-4">
                            <h3 class="text-xl font-bold mb-2">${product.name}</h3>
                            <p class="text-gray-600 mb-4">${product.description}</p>
                            <div class="flex items-center justify-between">
                                <span class="text-2xl font-bold text-green-600">${product.price.toFixed(2)}‚Ç¨</span>
                                <button class="bg-gradient-to-r from-blue-600 via-green-600 to-yellow-500 text-white p-3 rounded-full hover:shadow-lg transition-all duration-300 touch-feedback">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            function showToast(message, type = 'info') {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.className = `fun-toast ${type} show`;
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }

            function createConfetti() {
                const colors = ['#1e40af', '#16a34a', '#eab308', '#f59e0b', '#22c55e'];
                
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'fixed';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.width = '10px';
                    confetti.style.height = '10px';
                    confetti.style.zIndex = '3000';
                    confetti.style.animation = 'confetti-fall 3s ease-in-out';
                    confetti.style.animationDelay = Math.random() * 3 + 's';
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 6000);
                }
            }

            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            // Gestion de la connectivit√©
            window.addEventListener('online', () => {
                document.getElementById('connection-indicator').innerHTML = '<i class="fas fa-wifi mr-2"></i>En ligne';
                document.getElementById('connection-indicator').className = 'bg-green-500 text-white px-4 py-2 rounded-full text-sm';
            });

            window.addEventListener('offline', () => {
                document.getElementById('connection-indicator').innerHTML = '<i class="fas fa-wifi-slash mr-2"></i>Hors ligne';
                document.getElementById('connection-indicator').className = 'bg-red-500 text-white px-4 py-2 rounded-full text-sm';
            });

            // API pour int√©gration
            window.kioskApp = {
                setServiceMode,
                setTableNumber,
                toggleAllergen,
                showProductModal,
                addToCart,
                showToast,
                getState: () => appState
            };

            console.log('‚úÖ Kiosque pr√™t ! API disponible via window.kioskApp');
        </script>
    </body>
</html>